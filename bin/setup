#!/bin/sh

if ! [ -x "$(command -v postgres)" ]; then
  echo 'Error: postgres is not installed.' >&2
  exit 1
fi

echo "DROP DATABASE IF EXISTS crystal_orm_test;" | psql -U postgres
echo "CREATE DATABASE crystal_orm_test;" | psql -U postgres

read -r -d '' STR << SQL
BEGIN;
DROP TABLE IF EXISTS users CASCADE;
CREATE TABLE users(
  id SERIAL PRIMARY KEY,
  name character varying NOT NULL,
  created_at timestamp without time zone,
  updated_at timestamp without time zone
);
COMMIT;
SQL
echo $STR | psql -U postgres crystal_orm_test
